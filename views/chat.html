<!DOCTYPE html>
<html lang="en">
<body>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.6/angular.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.6/angular-sanitize.js"></script>
<script>
    var app = angular.module('myApp', ['ngSanitize']);
    app.controller('ChatSend', function($scope, $http) {
        $scope.username = "";
        $scope.msg = "";
        $scope.algo2 = function () { return $scope.msg };
        $scope.sendMsg = function () {
            $http.post('/api/chat', {username:"<%= session.username %>", msg:$scope.algo2()});
            $scope.msg = null;
        }
    });
    app.controller('ChatRecv', function ($scope, $http, $timeout) {
        $scope.lista = [];
        var retrieve = function() {
            $http.get('/api/chat').then(function (response) {
                $scope.lista = response.data;
                $timeout(retrieve, 500);
            });
        };
        retrieve();
    })
</script>
<div class="container" data-ng-app="myApp">
<form class="form-horizontal">
    <div class="form-group" data-ng-controller="ChatSend">
        <label>Username</label>
        <label data-ng-model="username"><%= session.username %></label>
        <label for="msg">msg</label>
        <input name="msg" id="msg" type="text" data-ng-model="msg" />
        <button data-ng-click="sendMsg()" class="btn btn-primary">Submit</button>
    </div>
</form>
<div data-ng-controller='ChatRecv'>
    <table>
        <tr>
            <th>user</th>
            <th>msg</th>
        </tr>
        <tr data-ng-repeat="i in lista">
            <td>{{ i.username }}</td>
            <td>{{ i.msg }}</td>
        </tr>
    </table>
</div>
</div>

</body>
</html>